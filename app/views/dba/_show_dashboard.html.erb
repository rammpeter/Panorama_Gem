<%
  @update_area          = get_unique_area_id
  @submit_id            = get_unique_area_id
  @refresh_id           = get_unique_area_id
  @form_id              = get_unique_area_id
  @hours_to_cover_id    = get_unique_area_id
  @refresh_cycle_id     = get_unique_area_id
  @wait_class_canvas_id = get_unique_area_id
  @unique_id            = get_unique_area_id
%>

  <div style="display: flex; flex-direction: row; justify-content: space-between">
    <div class="flex-row-element">
      <b>Online-Dashboard</b>
      <%= submit_tag('', id: @submit_id, style: "visibility: hidden") %>
    </div>

    <div class="flex-row-element" title="Show data for the choosen time period up to now">
      Time to cover
      <select name="hours_to_cover" id="<%= @hours_to_cover_id %>" onchange="hours_to_cover_changed();">
        <option value="0.083333" selected>5 minutes</option>
        <option value="0.25">15 minutes</option>
        <option value="0.5">30 minutes</option>
        <option value="1">1 hour</option>
        <option value="3">3 hours</option>
        <option value="6">6 hours</option>
        <option value="12">12 hours</option>
        <option value="24">24 hours</option>
        <option value="48">48 hours</option>
      </select>
    </div>

    <div class="flex-row-element" title="Cycle of automatic refresh (adds delta only to already selected data)">
      Refresh cycle
      <select name="refresh_cycle_minutes" id="<%= @refresh_cycle_id %>" onchange="refresh_cycle_changed();">
        <option value="0" selected>off</option>
        <option value="0.25">15 seconds</option>
        <option value="0.5">30 seconds</option>
        <option value="1">1 minute</option>
        <option value="5">5 minutes</option>
        <option value="10">10 minutes</option>
        <option value="15">15 minutes</option>
      </select>
      <%= submit_tag('Refresh', id: @refresh_id, title: 'Manually refresh dashboard content', onclick: "submit_refresh();") %>
    </div>
  </div>


<div id="<%= @wait_class_canvas_id %>"></div>
<div id="<%= @update_area %>"></div>

<script type="application/javascript">
    //$('#<%= @submit_id %>').click();                                          // call subdialog at first open

    function hours_to_cover_changed(){
        dashboard_data = undefined;                                             // Ensure whole dashboard data is refreshed now to other hours_to_cover
        var selected = $('#<%= @refresh_cycle_id %>').children("option:selected").val();
        if (selected != '0'){
            submit_refresh();
        }
    }

    function refresh_cycle_changed(){
        var selected = $('#<%= @refresh_cycle_id %>').children("option:selected").val();
        if (selected == '0')
            $('#<%= @refresh_id %>').attr('type', 'submit');
        else {
            $('#<%= @refresh_id %>').attr('type', 'hidden');
            submit_refresh();
        }
    }

    function submit_refresh(){
        var hours_to_cover          = $('#<%= @hours_to_cover_id %>').children("option:selected").val();
        var refresh_cycle_minutes   = $('#<%= @refresh_cycle_id %>').children("option:selected").val();
        refresh_dashboard('<%= @unique_id %>', '<%= @wait_class_canvas_id %>', hours_to_cover, refresh_cycle_minutes, '<%= @refresh_cycle_id %>');
        return false;
    }
</script>
