<%
  @update_area      = get_unique_area_id
  @submit_id        = get_unique_area_id
  @refresh_id       = get_unique_area_id
  @form_id          = get_unique_area_id
  @refresh_cycle_id = get_unique_area_id
%>

<%= ajax_form({controller: :dba, action: :list_dashboard, update_area: @update_area, refresh_cycle_id: @refresh_cycle_id}, {id: @form_id}) do %>
  <div style="display: flex; flex-direction: row; justify-content: space-between">
    <div class="flex-row-element">
      <b>Online-Dashboard</b>
      <%= submit_tag('', id: @submit_id, style: "visibility: hidden") %>
    </div>

    <div class="flex-row-element">
      Time to cover
      <select name="hours_to_cover" onchange="submit_if_not_refresh_off();">
        <option value="0.083333">5 minutes</option>
        <option value="0.25">15 minutes</option>
        <option value="0.5">30 minutes</option>
        <option value="1" selected>1 hour</option>
        <option value="3">3 hours</option>
        <option value="6">6 hours</option>
        <option value="12">12 hours</option>
        <option value="24">24 hours</option>
        <option value="48">48 hours</option>
      </select>
    </div>

    <div class="flex-row-element">
      Refresh cycle
      <select name="refresh_cycle_minutes" id="<%= @refresh_cycle_id %>" onchange="set_refresh_visibility(); submit_if_not_refresh_off();">
        <option value="0" selected>off</option>
        <option value="0.25">15 seconds</option>
        <option value="0.5">30 seconds</option>
        <option value="1">1 minute</option>
        <option value="5">5 minutes</option>
        <option value="10">10 minutes</option>
        <option value="15">15 minutes</option>
      </select>
      <%= submit_tag('Refresh', id: @refresh_id, title: 'Manually refresh dashboard content') %>
    </div>
  </div>

<% end %>

<div id="<%= @update_area %>"></div>

<script type="application/javascript">
    //$('#<%= @submit_id %>').click();                                            // call subdialog at first open

    function submit_if_not_refresh_off(){
        var selected = $('#<%= @refresh_cycle_id %>').children("option:selected").val();
        if (selected != '0')
            $('#<%= @form_id %>').submit();
    }

    function set_refresh_visibility(){
        var selected = $('#<%= @refresh_cycle_id %>').children("option:selected").val();
        if (selected == '0')
            $('#<%= @refresh_id %>').attr('type', 'submit');
        else
            $('#<%= @refresh_id %>').attr('type', 'hidden');
    }
</script>
